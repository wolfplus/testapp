<ion-header class="top-element-bs">
  <app-default-header
          [title]="courseName"
          [subtitle]="'group_chat'"
          (back)="close()"
  >
  </app-default-header>
</ion-header>

<ion-content >
  <ion-infinite-scroll position="top" (ionInfinite)="loadOlderMessages()">
    <ion-infinite-scroll-content
            loadingSpinner="bubbles"
            loadingText="{{ 'loading_more_messages' | translate }}"
    >
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>
  <ion-list *ngIf="comments && comments.length">
    <!-- disabled="(comment?.user.id !== userId) || comment?.user['@type'] === 'UserClub'" -->
    <ion-item-sliding
            *ngFor="let comment of comments; let i = index"
            [disabled]="!(comment?.user.id === userId)"
    >
      <ion-item-options side="start">
        <ion-item-option
                color="container-2"
                icon-only
                expandable
                (click)="deleteComment(comment, i)"
        >
          <ion-icon name="trash-outline"></ion-icon>
        </ion-item-option>
      </ion-item-options>
      <ion-item lines="none">
        <ion-thumbnail slot="start" class="pos-rel">
          <img
                  *ngIf="
              (comment?.user?.avatar === null ||
                comment?.user?.avatar?.contentUrl === null) &&
              !(comment?.user['@type'] === 'UserClub')
            "
                  src="{{
              'https://eu.ui-avatars.com/api/?background=' +
                avatarBgColor +
                '&color=fff&name=' +
                comment?.user?.firstName +
                ' ' +
                comment?.user?.shortcutLastName
            }}"
                  alt=""
          />
          <img
                  *ngIf="comment?.user['@type'] === 'UserClub'"
                  src="{{ baseUrl + clubLogoUrl }}"
                  alt=""
          />
          <img
                  *ngIf="
              comment?.user?.avatar &&
              comment?.user?.avatar?.contentUrl !== null &&
              comment?.user['@type'] !== 'UserClub'
            "
                  src="{{ baseUrl + comment.user.avatar.contentUrl }}"
                  alt=""
          />
          <ion-icon
                  *ngIf="comment?.user.id === userId"
                  src="assets/images/icons/star_filled.svg"
                  class="pos-abs-btm-left star"
          >
          </ion-icon>
        </ion-thumbnail>
        <ion-label class="flex jcsb">
          <div class="flex aic jcsb w-100">
            <div
                    *ngIf="comment?.user['@type'] !== 'UserClub'"
                    class="user-name"
            >
              {{ comment.user.firstName + " " + comment.user.shortcutLastName }}
            </div>
            <div
                    *ngIf="comment?.user['@type'] === 'UserClub'"
                    class="user-name"
            >
              {{ club.name }}
            </div>
            <div class="flex d-col aic jcc">
              <div class="comment-date">
                {{ comment.createdAt | date: "dd/MM/yy" }}
              </div>
              <div class="comment-time">
                {{ comment.createdAt | date: "HH:mm" }}
              </div>
            </div>
          </div>
          <p
                  class="user-comment"
                  [innerHtml]="sanitizer.bypassSecurityTrustHtml(comment.text)"
          ></p>
        </ion-label>
      </ion-item>
    </ion-item-sliding>
  </ion-list>
   <!--<ion-refresher slot="fixed"
    (ionRefresh)="refresh($event)">
    <ion-refresher-content
      pullingIcon=null
      refreshingSpinner="circles">
    </ion-refresher-content>
  </ion-refresher>-->
</ion-content>

<ion-footer class="flex aife" #footer>
  <div class="message-input flex aic jcsb do-mb-2 w-100">
    <ion-textarea
            [(ngModel)]="comment"
            placeholder="{{ 'comments_write' | translate }}"
    >
    </ion-textarea>
    <div class="post-comment-button">
      <ion-button (click)="postComment()">
        <ion-icon name="send"></ion-icon>
      </ion-button>
    </div>
  </div>
</ion-footer>
